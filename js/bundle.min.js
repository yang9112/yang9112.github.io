class Application{constructor(){this.modules=new Map,this.config={debug:!1,modules:["ResponsiveModule","GalleryModule","ScrollToTopModule","PreloaderModule"]}}init(){this.log("Initializing application..."),$(document).ready(()=>{this.loadModules(),this.setupEventListeners(),this.optimizePerformance()})}loadModules(){this.config.modules.forEach(e=>{const t=window[e];if(t&&"function"==typeof t.init)try{t.init(),this.log("Module initialized:",e)}catch(t){this.log("Error initializing module:",e,t)}else this.log("Module not found:",e)})}setupEventListeners(){window.performance&&window.performance.timing&&window.addEventListener("load",()=>{const e=window.performance.timing.loadEventEnd-window.performance.timing.navigationStart;this.log("Page load time:",e+"ms")}),window.addEventListener("error",e=>{this.log("JavaScript error:",e.error)}),window.addEventListener("online",()=>{this.log("Connection restored"),$("body").removeClass("offline").addClass("online")}),window.addEventListener("offline",()=>{this.log("Connection lost"),$("body").removeClass("online").addClass("offline")})}optimizePerformance(){$("body").addClass("js-loaded"),this.preloadFonts(),this.setupPassiveListeners()}preloadFonts(){[].forEach(e=>{const t=document.createElement("link");t.rel="preload",t.as="font",t.type="font/woff2",t.crossOrigin="anonymous",t.href=e,document.head.appendChild(t)})}setupPassiveListeners(){this.detectPassiveEvents()&&(document.addEventListener("touchstart",()=>{},{passive:!0}),document.addEventListener("touchmove",()=>{},{passive:!0}))}detectPassiveEvents(){let e=!1;try{const t=Object.defineProperty({},"passive",{get:function(){return e=!0,!0}});window.addEventListener("testPassive",()=>{},t),window.removeEventListener("testPassive",()=>{},t)}catch(e){}return e}log(...e){if(this.config.debug&&console&&console.log){const t=["[APP]",...e];console.log.apply(console,t)}}}const app=new Application;app.init(),window.App=app;export default Application;!function(e){"use strict";const t=function(){e(".entry").each(function(t){e(this).find("img").each(function(){if(!e(this).hasClass("nofancybox")){var n=this.alt;n&&e(this).after('<span class="caption">'+n+"</span>"),e(this).wrap('<a href="'+this.src+'" title="'+n+'" class="fancybox" rel="gallery'+t+'" />')}})})},n=function(){var t=function(e,t,n){var s=e.width();t.imagesLoaded(function(){var t=this[0],o=t.naturalWidth,a=t.naturalHeight;n(),this.animate({opacity:1},500),e.animate({height:s*a/o},500)})};e(".gallery").each(function(){var n=e(this),s=0,o=n.children(".photoset").children(),a=o.length,i=!0;t(n,o.eq(0),function(){i=!1}),n.on("click",".prev",function(){if(!i){var e=(s-1)%a;i=!0,t(n,o.eq(e),function(){o.eq(s).animate({opacity:0},500),i=!1,s=e})}}).on("click",".next",function(){if(!i){var e=(s+1)%a;i=!0,t(n,o.eq(e),function(){o.eq(s).animate({opacity:0},500),i=!1,s=e})}})})},s={init:function(){t(),n()}};window.GalleryModule=s}(jQuery),function(e){"use strict";const t={config:{upperLimit:1e3,scrollSpeed:500,scrollElem:e("#totop")},init:function(){const t=this.config;t.scrollElem.hide(),e(window).scroll(function(){e(document).scrollTop()>t.upperLimit?t.scrollElem.stop().fadeTo(300,1):t.scrollElem.stop().fadeTo(300,0)}),t.scrollElem.click(function(){return e("html, body").animate({scrollTop:0},t.scrollSpeed),!1})}};window.ScrollToTopModule=t}(jQuery),function(e){"use strict";const t={config:{mobileBreakpoint:768,touchThreshold:10},init:function(){this.setupMobileMenu(),this.setupTouchGestures(),this.setupViewportOptimizations()},setupMobileMenu:function(){const t=e("#nav"),n=e(".header");if(t.length&&n.length){const s=e('<button class="mobile-menu-toggle" aria-label="Toggle menu"><span class="menu-icon"></span></button>');n.prepend(s),s.on("click",function(n){n.preventDefault(),t.toggleClass("mobile-open"),s.toggleClass("active"),e("body").toggleClass("menu-open")}),e(document).on("click",function(n){e(n.target).closest(".header, #nav").length||(t.removeClass("mobile-open"),s.removeClass("active"),e("body").removeClass("menu-open"))})}},setupTouchGestures:function(){let n=0,s=0;e(document).on("touchstart",function(e){n=e.originalEvent.touches[0].clientX}),e(document).on("touchend",function(o){s=o.originalEvent.changedTouches[0].clientX,function(){const o=s-n;Math.abs(o)>t.config.touchThreshold&&(o>0?e(document).trigger("swipeRight"):e(document).trigger("swipeLeft"))}()})},setupViewportOptimizations:function(){let n;this.optimizeImages(),e(window).on("resize",function(){clearTimeout(n),n=setTimeout(function(){t.handleResize()},250)})},optimizeImages:function(){const t=window.innerWidth<=this.config.mobileBreakpoint;e("img").each(function(){const n=e(this);n.attr("loading")||n.attr("loading","lazy"),t&&!n.hasClass("no-resize")&&n.addClass("mobile-optimized")})},handleResize:function(){const t=window.innerWidth<=this.config.mobileBreakpoint;e("body").toggleClass("mobile-view",t).toggleClass("desktop-view",!t),this.optimizeImages()}};window.ResponsiveModule=t}(jQuery),function(e){"use strict";const t={config:{criticalCSS:["css/style.min.css"],criticalJS:["js/modules/gallery.js","js/modules/scrollToTop.js"],imageTypes:[".jpg",".jpeg",".png",".webp",".svg"],preloadImages:!0},init:function(){this.preloadCriticalResources(),this.setupIntersectionObserver(),this.createServiceWorker()},preloadCriticalResources:function(){const e=this.config;e.criticalCSS.forEach(function(e){const t=document.createElement("link");t.rel="preload",t.as="style",t.href=e,document.head.appendChild(t)}),e.criticalJS.forEach(function(e){const t=document.createElement("link");t.rel="preload",t.as="script",t.href=e,document.head.appendChild(t)})},setupIntersectionObserver:function(){if(!("IntersectionObserver"in window))return;const e=new IntersectionObserver(function(t){t.forEach(function(t){if(t.isIntersecting){const n=t.target;n.dataset.src&&(n.src=n.dataset.src,n.removeAttribute("data-src"),e.unobserve(n))}})},{rootMargin:"50px 0px",threshold:.01});document.querySelectorAll("img[data-src]").forEach(function(t){e.observe(t)})},createServiceWorker:function(){const e=new Blob(["\nconst CACHE_NAME = 'blog-cache-v1';\nconst urlsToCache = [\n  '/',\n  '/dist/index.html',\n  '/dist/css/style.min.css',\n  '/dist/js/bundle.min.js'\n];\n\nself.addEventListener('install', function(event) {\n  event.waitUntil(\n    caches.open(CACHE_NAME)\n      .then(function(cache) {\n        return cache.addAll(urlsToCache);\n      })\n  );\n});\n\nself.addEventListener('fetch', function(event) {\n  event.respondWith(\n    caches.match(event.request)\n      .then(function(response) {\n        // Cache hit - return response\n        if (response) {\n          return response;\n        }\n        return fetch(event.request);\n      }\n    )\n  );\n});\n      "],{type:"application/javascript"}),t=URL.createObjectURL(e);"serviceWorker"in navigator&&navigator.serviceWorker.register(t).then(function(e){console.log("ServiceWorker registration successful")}).catch(function(e){console.log("ServiceWorker registration failed:",e)})},prefetchResources:function(){e('a[href*=".jpg"], a[href*=".png"], a[href*=".jpeg"]').each(function(){const t=e(this).attr("href");if(t&&!t.startsWith("http")){const e=document.createElement("link");e.rel="prefetch",e.href=t,document.head.appendChild(e)}})}};window.PreloaderModule=t}(jQuery);class SocialShare{constructor(){this.init()}init(){this.addShareButtons(),this.initShareEvents()}addShareButtons(){document.querySelectorAll(".article-entry").forEach(e=>{document.querySelector("title"),window.location.href;const t=document.createElement("div");t.className="social-share-container",t.innerHTML='\n        <div class="social-share">\n          <span class="share-label">åˆ†äº«åˆ°ï¼š</span>\n          <a href="#" class="share-btn share-weibo" data-platform="weibo" title="åˆ†äº«åˆ°å¾®åš">\n            <i class="fab fa-weibo"></i>\n          </a>\n          <a href="#" class="share-btn share-twitter" data-platform="twitter" title="åˆ†äº«åˆ°Twitter">\n            <i class="fab fa-twitter"></i>\n          </a>\n          <a href="#" class="share-btn share-facebook" data-platform="facebook" title="åˆ†äº«åˆ°Facebook">\n            <i class="fab fa-facebook-f"></i>\n          </a>\n          <a href="#" class="share-btn share-linkedin" data-platform="linkedin" title="åˆ†äº«åˆ°LinkedIn">\n            <i class="fab fa-linkedin-in"></i>\n          </a>\n          <a href="#" class="share-btn share-copy" data-platform="copy" title="å¤åˆ¶é“¾æ¥">\n            <i class="fas fa-link"></i>\n          </a>\n        </div>\n      ',e.firstChild&&e.appendChild(t)})}initShareEvents(){document.querySelectorAll(".share-btn").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const n=e.dataset.platform;this.share(n)})})}share(e){const t=document.querySelector("title")?.textContent||"Yang's Home",n=window.location.href,s=(document.querySelector('meta[name="description"]'),{weibo:`https://service.weibo.com/share/share.php?url=${encodeURIComponent(n)}&title=${encodeURIComponent(t)}`,twitter:`https://twitter.com/intent/tweet?url=${encodeURIComponent(n)}&text=${encodeURIComponent(t)}`,facebook:`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(n)}`,linkedin:`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(n)}`});"copy"===e?this.copyToClipboard(n):s[e]&&window.open(s[e],"_blank","width=600,height=400,scrollbars=yes,resizable=yes")}copyToClipboard(e){navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(e).then(()=>{this.showCopyMessage()}).catch(t=>{console.error("Failed to copy: ",t),this.fallbackCopyToClipboard(e)}):this.fallbackCopyToClipboard(e)}fallbackCopyToClipboard(e){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy"),this.showCopyMessage()}catch(e){console.error("Fallback: Oops, unable to copy",e)}document.body.removeChild(t)}showCopyMessage(){const e=document.querySelector(".share-copy"),t=e.innerHTML;e.innerHTML='<i class="fas fa-check"></i>',e.style.color="#4CAF50",setTimeout(()=>{e.innerHTML=t,e.style.color=""},2e3)}}document.addEventListener("DOMContentLoaded",()=>{new SocialShare});class LazyLoader{constructor(){this.imageObserver=null,this.loadedImages=new Set,this.init()}init(){"IntersectionObserver"in window?this.setupIntersectionObserver():this.setupLegacyLoading()}setupIntersectionObserver(){this.imageObserver=new IntersectionObserver((e,t)=>{e.forEach(e=>{if(e.isIntersecting){const n=e.target;this.loadImage(n),t.unobserve(n)}})},{root:null,rootMargin:"50px 0px",threshold:.1}),this.observeImages()}setupLegacyLoading(){let e=null;const t=()=>{this.lazyLoadLegacy()},n=()=>{e&&clearTimeout(e),e=setTimeout(t,200)};window.addEventListener("scroll",n),window.addEventListener("resize",n),window.addEventListener("orientationchange",n),t()}observeImages(){document.querySelectorAll("img[data-src]").forEach(e=>{this.loadedImages.has(e.src)||this.imageObserver.observe(e)})}lazyLoadLegacy(){const e=document.querySelectorAll("img[data-src]"),t=window.innerHeight;e.forEach(e=>{const n=e.getBoundingClientRect();n.top>=0&&n.top<=t+200&&!this.loadedImages.has(e.src)&&this.loadImage(e)})}loadImage(e){const t=e.getAttribute("data-src");if(!t||this.loadedImages.has(t))return;this.loadedImages.add(t);const n=new Image;n.onload=()=>{e.src=t,e.removeAttribute("data-src"),e.classList.add("loaded"),this.addLoadingAnimation(e)},n.onerror=()=>{e.classList.add("error"),console.warn("Failed to load image:",t)},n.src=t}addLoadingAnimation(e){e.style.opacity="0",e.style.transition="opacity 0.3s ease-in-out",setTimeout(()=>{e.style.opacity="1"},10)}convertExistingImages(){document.querySelectorAll("img:not([data-src])").forEach(e=>{e.src.includes("data:")||e.hasAttribute("data-skip-lazy")||e.width<100||e.height<100||(e.setAttribute("data-src",e.src),e.src=this.getPlaceholderImage(),this.imageObserver&&this.imageObserver.observe(e))})}getPlaceholderImage(){return"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMSIgaGVpZ2h0PSIxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiNmMGYwZjAiLz48L3N2Zz4="}preloadCriticalImages(){document.querySelectorAll("img[data-critical]").forEach(e=>{const t=e.getAttribute("data-src");if(t&&!this.loadedImages.has(t)){const e=document.createElement("link");e.rel="preload",e.as="image",e.href=t,document.head.appendChild(e)}})}static init(){return window.lazyLoader||(window.lazyLoader=new LazyLoader),window.lazyLoader}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>LazyLoader.init()):LazyLoader.init(),"undefined"!=typeof module&&module.exports&&(module.exports=LazyLoader);class EnhancedSearch{constructor(){this.searchData=new Map,this.searchIndex=new Map,this.isInitialized=!1,this.searchForm=null,this.searchInput=null,this.searchResults=null,this.init()}init(){this.setupSearchElements(),this.buildSearchIndex(),this.bindEvents(),this.isInitialized=!0}setupSearchElements(){if(this.searchForm=document.querySelector(".search"),this.searchInput=document.querySelector('.search input[type="search"]'),!document.getElementById("search-results")){const e=document.createElement("div");e.id="search-results",e.className="search-results",e.innerHTML='\n        <div class="search-results-header">\n          <h3>æœç´¢ç»“æœ</h3>\n          <button class="search-close" id="searchClose">&times;</button>\n        </div>\n        <div class="search-results-list" id="searchResultsList"></div>\n      ',document.body.appendChild(e)}this.searchResults=document.getElementById("search-results"),this.searchResultsList=document.getElementById("searchResultsList")}buildSearchIndex(){document.querySelectorAll("article.post, article.page").forEach((e,t)=>{const n=e.querySelector("h1")?.textContent||"",s=e.querySelector(".article-content")?.textContent||"",o=e.querySelector("a[href]")?.href||window.location.href,a=e.querySelector("time")?.textContent||"",i=this.extractCategories(e),r=this.extractTags(e),c={index:t,title:n.toLowerCase(),content:s.toLowerCase(),url:o,date:a,categories:i.map(e=>e.toLowerCase()),tags:r.map(e=>e.toLowerCase()),excerpt:this.createExcerpt(s)};this.searchData.set(t,c),this.indexKeywords(c)})}extractKeywords(e){const t=new Set(["the","a","an","and","or","but","in","on","at","to","for","of","with","by","from","is","was","are","were","been","have","has","had","do","does","did","will","would","could","should"]);return e.toLowerCase().split(/[\\s\\W_]+/).filter(e=>e.length>2&&!t.has(e)).filter(e=>/[\\u4e00-\\u9fa5a-zA-Z0-9]/.test(e))}indexKeywords(e){const t=`${e.title} ${e.content} ${e.categories.join(" ")} ${e.tags.join(" ")}`;this.extractKeywords(t).forEach(t=>{this.searchIndex.has(t)||this.searchIndex.set(t,new Set),this.searchIndex.get(t).add(e.index)})}extractCategories(e){const t=[];return e.querySelectorAll(".article-categories a").forEach(e=>t.push(e.textContent)),t}extractTags(e){const t=[];return e.querySelectorAll(".article-tags a").forEach(e=>t.push(e.textContent)),t}createExcerpt(e,t=150){const n=e.replace(/<[^>]*>/g,"").trim();if(n.length<=t)return n;const s=n.substring(0,t),o=s.lastIndexOf(" ");return o>0?s.substring(0,o)+"...":s+"..."}bindEvents(){this.searchInput&&(this.searchInput.addEventListener("input",this.debounce(e=>{const t=e.target.value.trim();t.length>=2?this.performSearch(t):this.hideSearchResults()},300)),this.searchInput.addEventListener("keydown",e=>{if("Enter"===e.key){e.preventDefault();const t=e.target.value.trim();t.length>=2&&this.performSearch(t)}"Escape"===e.key&&this.hideSearchResults()}));const e=document.getElementById("searchClose");e&&e.addEventListener("click",()=>this.hideSearchResults()),document.addEventListener("click",e=>{this.searchResults.contains(e.target)||this.searchForm.contains(e.target)||this.hideSearchResults()})}performSearch(e){const t=this.extractKeywords(e),n=new Map;t.forEach(e=>{const s=this.searchIndex.get(e);s&&s.forEach(e=>{if(this.searchData.has(e)){const s=this.searchData.get(e),o=this.calculateScore(s,t);(!n.has(e)||n.get(e).score<o)&&n.set(e,{...s,score:o})}})});const s=Array.from(n.values()).sort((e,t)=>t.score-e.score).slice(0,10);this.displaySearchResults(s,e)}calculateScore(e,t){let n=0;const s=e.title,o=e.content;t.forEach(t=>{s.includes(t)&&(n+=t===s?10:5);const a=(o.match(new RegExp(t,"g"))||[]).length;n+=a,e.categories.forEach(e=>{e.includes(t)&&(n+=3)}),e.tags.forEach(e=>{e.includes(t)&&(n+=2)})});const a=t.join(" ");return o.includes(a)&&(n+=8),s.includes(a)&&(n+=15),n}displaySearchResults(e,t){0===e.length?this.searchResultsList.innerHTML=`\n        <div class="no-results">\n          <i class="fas fa-search"></i>\n          <p>æœªæ‰¾åˆ°ä¸ "<strong>${this.escapeHtml(t)}</strong>" ç›¸å…³çš„å†…å®¹</p>\n          <p>å»ºè®®ï¼š</p>\n          <ul>\n            <li>æ£€æŸ¥æ‹¼å†™æ˜¯å¦æ­£ç¡®</li>\n            <li>å°è¯•ä½¿ç”¨æ›´é€šç”¨çš„å…³é”®è¯</li>\n            <li>å°è¯•ä½¿ç”¨ä¸åŒçš„æœç´¢è¯</li>\n          </ul>\n        </div>\n      `:this.searchResultsList.innerHTML=e.map(e=>{const n=this.highlightText(e.title,t),s=this.highlightText(e.excerpt,t);return`\n          <div class="search-result-item">\n            <h4><a href="${e.url}">${n}</a></h4>\n            <p class="search-result-excerpt">${s}</p>\n            <div class="search-result-meta">\n              ${e.date?`<span class="search-result-date">${e.date}</span>`:""}\n              ${e.categories.length>0?`\n                <span class="search-result-categories">\n                  <i class="fas fa-folder"></i> ${e.categories.join(", ")}\n                </span>\n              `:""}\n              ${e.tags.length>0?`\n                <span class="search-result-tags">\n                  <i class="fas fa-tag"></i> ${e.tags.slice(0,3).join(", ")}\n                  ${e.tags.length>3?"...":""}\n                </span>\n              `:""}\n            </div>\n          </div>\n        `}).join(""),this.showSearchResults()}highlightText(e,t){if(!t)return this.escapeHtml(e);const n=this.extractKeywords(t);let s=this.escapeHtml(e);return n.forEach(e=>{const t=new RegExp(`(${e})`,"gi");s=s.replace(t,"<mark>$1</mark>")}),s}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}showSearchResults(){this.searchResults.classList.add("show"),document.body.style.overflow="hidden"}hideSearchResults(){this.searchResults.classList.remove("show"),document.body.style.overflow="",this.searchInput&&(this.searchInput.value="")}debounce(e,t){let n;return function(...s){clearTimeout(n),n=setTimeout(()=>{clearTimeout(n),e(...s)},t)}}static init(){return window.enhancedSearch||(window.enhancedSearch=new EnhancedSearch),window.enhancedSearch}search(e){this.isInitialized&&this.performSearch(e)}clearSearch(){this.hideSearchResults()}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>EnhancedSearch.init()):EnhancedSearch.init(),"undefined"!=typeof module&&module.exports&&(module.exports=EnhancedSearch);class EnhancedComments{constructor(e={}){this.options={container:"#comments",apiUrl:"/api/comments",enableReplies:!0,enableModeration:!1,enableRichText:!0,maxCharacters:1e3,autoSave:!0,...e},this.comments=[],this.currentUser=null,this.sortBy="newest",this.isLoading=!1,this.init()}async init(){try{await this.loadCurrentUser(),await this.loadComments(),this.setupEventListeners(),this.render()}catch(e){console.error("Failed to initialize comments:",e),this.showError("è¯„è®ºç³»ç»ŸåŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•")}}setupEventListeners(){const e=document.querySelector("#comment-form");e&&e.addEventListener("submit",e=>this.handleFormSubmit(e));const t=document.querySelector("#comment-text");t&&t.addEventListener("input",e=>this.updateCharacterCount(e)),this.options.enableRichText&&this.setupRichTextEditor(),document.querySelectorAll(".sort-btn").forEach(e=>{e.addEventListener("click",e=>this.handleSort(e))})}async loadCurrentUser(){try{this.currentUser={id:"user_"+Math.random().toString(36).substr(2,9),name:"è®¿å®¢ç”¨æˆ·",avatar:null,email:null}}catch(e){console.warn("Failed to load user:",e)}}async loadComments(){this.isLoading=!0;try{const e=[{id:"1",author:"å¼ ä¸‰",content:"è¿™ä¸ªç½‘ç«™è®¾è®¡å¾—çœŸä¸é”™ï¼ç•Œé¢ç®€æ´ç¾è§‚ï¼ŒåŠ è½½é€Ÿåº¦ä¹Ÿå¾ˆå¿«ã€‚",timestamp:new Date(Date.now()-36e5).toISOString(),likes:5,replies:[{id:"1-1",author:"æå››",content:"åŒæ„æ¥¼ä¸Šçš„è§‚ç‚¹ï¼Œç‰¹åˆ«æ˜¯æ·±è‰²æ¨¡å¼çš„è®¾è®¡å¾ˆè´´å¿ƒã€‚",timestamp:new Date(Date.now()-18e5).toISOString(),likes:2}]},{id:"2",author:"ç‹äº”",content:"è¯·é—®ç½‘ç«™çš„æºç æ˜¯å¼€æºçš„å—ï¼Ÿæƒ³å­¦ä¹ ä¸€ä¸‹å‰ç«¯å¼€å‘æŠ€æœ¯ã€‚",timestamp:new Date(Date.now()-72e5).toISOString(),likes:3}];this.comments=e}catch(e){console.error("Failed to load comments:",e),this.comments=[]}finally{this.isLoading=!1}}render(){const e=document.querySelector(this.options.container);e&&(e.innerHTML=`\n            <div class="comments-section">\n                ${this.renderHeader()}\n                ${this.renderForm()}\n                ${this.renderCommentsList()}\n                ${this.renderLoadMore()}\n            </div>\n        `,this.attachEventListeners())}renderHeader(){return`\n            <div class="comments-header">\n                <div class="comments-count">å…± ${this.getTotalComments()} æ¡è¯„è®º</div>\n                <div class="comments-sort">\n                    <button class="sort-btn ${"newest"===this.sortBy?"active":""}" data-sort="newest">\n                        æœ€æ–°\n                    </button>\n                    <button class="sort-btn ${"popular"===this.sortBy?"active":""}" data-sort="popular">\n                        æœ€çƒ­\n                    </button>\n                    <button class="sort-btn ${"oldest"===this.sortBy?"active":""}" data-sort="oldest">\n                        æœ€æ—©\n                    </button>\n                </div>\n            </div>\n        `}renderForm(){return this.currentUser?`\n            <div class="comment-form">\n                <form id="comment-form">\n                    <div class="form-group">\n                        <label class="form-label" for="comment-text">å‘è¡¨è¯„è®º</label>\n                        <textarea \n                            id="comment-text" \n                            class="form-textarea" \n                            placeholder="åˆ†äº«ä½ çš„æƒ³æ³•..."\n                            maxlength="${this.options.maxCharacters}"\n                            required\n                        ></textarea>\n                        <div class="character-count">\n                            <span id="char-count">0</span> / ${this.options.maxCharacters}\n                        </div>\n                    </div>\n                    \n                    ${this.options.enableRichText?this.renderRichTextToolbar():""}\n                    \n                    <div class="form-toolbar">\n                        <div class="toolbar-actions">\n                            ${this.options.enableRichText?'\n                                <button type="button" class="toolbar-btn" data-action="bold">\n                                    <strong>B</strong>\n                                </button>\n                                <button type="button" class="toolbar-btn" data-action="italic">\n                                    <em>I</em>\n                                </button>\n                                <button type="button" class="toolbar-btn" data-action="link">\n                                    ğŸ”—\n                                </button>\n                            ':""}\n                        </div>\n                        <button type="submit" class="submit-btn" id="submit-btn">\n                            å‘è¡¨è¯„è®º\n                        </button>\n                    </div>\n                </form>\n            </div>\n        `:'\n                <div class="login-prompt">\n                    <p>è¯·ç™»å½•åå‘è¡¨è¯„è®º</p>\n                </div>\n            '}renderRichTextToolbar(){return'\n            <div class="rich-text-toolbar">\n                <div class="toolbar-actions">\n                    <button type="button" class="toolbar-btn" data-action="bold">\n                        <strong>B</strong>\n                    </button>\n                    <button type="button" class="toolbar-btn" data-action="italic">\n                        <em>I</em>\n                    </button>\n                    <button type="button" class="toolbar-btn" data-action="link">\n                        ğŸ”—\n                    </button>\n                    <button type="button" class="toolbar-btn" data-action="code">\n                        &lt;/&gt;\n                    </button>\n                    <button type="button" class="toolbar-btn" data-action="quote">\n                        â\n                    </button>\n                </div>\n            </div>\n        '}renderCommentsList(){if(this.isLoading)return'<div class="loading">åŠ è½½è¯„è®ºä¸­...</div>';if(0===this.comments.length)return'<div class="no-comments">è¿˜æ²¡æœ‰è¯„è®ºï¼Œæ¥å‘è¡¨ç¬¬ä¸€æ¡è¯„è®ºå§ï¼</div>';return`\n            <div class="comments-list">\n                ${this.sortComments(this.comments).map(e=>this.renderComment(e)).join("")}\n            </div>\n        `}renderComment(e,t=!1){return t?`\n                <div class="reply-item" data-comment-id="${e.id}">\n                    <div class="comment-header">\n                        <div class="comment-avatar">\n                            ${e.author.charAt(0).toUpperCase()}\n                        </div>\n                        <div class="comment-meta">\n                            <div class="comment-author">${e.author}</div>\n                            <div class="comment-time">${this.formatTime(e.timestamp)}</div>\n                        </div>\n                    </div>\n                    <div class="comment-content">\n                        ${this.formatContent(e.content)}\n                    </div>\n                    <div class="comment-actions">\n                        <button class="action-btn" data-action="like">\n                            ğŸ‘ ${e.likes||0}\n                        </button>\n                        ${this.options.enableReplies?'\n                            <button class="action-btn" data-action="reply">\n                                ğŸ’¬ å›å¤\n                            </button>\n                        ':""}\n                        ${this.options.enableModeration&&this.currentUser?.id===e.author?'\n                            <button class="action-btn" data-action="edit">\n                                âœï¸ ç¼–è¾‘\n                            </button>\n                            <button class="action-btn" data-action="delete">\n                                ğŸ—‘ï¸ åˆ é™¤\n                            </button>\n                        ':""}\n                    </div>\n                </div>\n            `:`\n            <div class="comment-item" data-comment-id="${e.id}">\n                <div class="comment-header">\n                    <div class="comment-avatar">\n                        ${e.author.charAt(0).toUpperCase()}\n                    </div>\n                    <div class="comment-meta">\n                        <div class="comment-author">${e.author}</div>\n                        <div class="comment-time">${this.formatTime(e.timestamp)}</div>\n                    </div>\n                    <div class="comment-actions">\n                        <button class="action-btn" data-action="like">\n                            ğŸ‘ ${e.likes||0}\n                        </button>\n                        ${this.options.enableReplies?'\n                            <button class="action-btn" data-action="reply">\n                                ğŸ’¬ å›å¤\n                            </button>\n                        ':""}\n                        ${this.options.enableModeration&&this.currentUser?.id===e.author?'\n                            <button class="action-btn" data-action="edit">\n                                âœï¸ ç¼–è¾‘\n                            </button>\n                            <button class="action-btn" data-action="delete">\n                                ğŸ—‘ï¸ åˆ é™¤\n                            </button>\n                        ':""}\n                    </div>\n                </div>\n                <div class="comment-content">\n                    ${this.formatContent(e.content)}\n                </div>\n                ${this.options.enableReplies&&e.replies?.length>0?`\n                    <div class="replies-section">\n                        <div class="replies-list">\n                            ${e.replies.map(e=>this.renderComment(e,!0)).join("")}\n                        </div>\n                    </div>\n                `:""}\n            </div>\n        `}renderLoadMore(){return 0===this.comments.length?"":'\n            <button class="load-more-btn" id="load-more-comments">\n                åŠ è½½æ›´å¤šè¯„è®º\n            </button>\n        '}attachEventListeners(){document.querySelectorAll(".action-btn").forEach(e=>{e.addEventListener("click",e=>{e.stopPropagation(),this.handleAction(e)})}),document.querySelectorAll(".toolbar-btn").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),this.handleRichTextAction(e)})});const e=document.querySelector("#load-more-comments");e&&e.addEventListener("click",()=>this.loadMoreComments())}handleFormSubmit(e){e.preventDefault();const t=document.querySelector("#comment-text").value.trim();t?this.submitComment(t):this.showError("è¯·è¾“å…¥è¯„è®ºå†…å®¹")}async submitComment(e){const t=document.querySelector("#submit-btn"),n=t.textContent;try{t.disabled=!0,t.textContent="å‘å¸ƒä¸­...";const n={id:"comment_"+Date.now(),author:this.currentUser.name,content:e,timestamp:(new Date).toISOString(),likes:0,replies:[]};this.comments.unshift(n),document.querySelector("#comment-text").value="",this.updateCharacterCount({target:{value:""}}),this.render(),this.showSuccess("è¯„è®ºå‘è¡¨æˆåŠŸï¼")}catch(e){console.error("Failed to submit comment:",e),this.showError("è¯„è®ºå‘è¡¨å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{t.disabled=!1,t.textContent=n}}handleAction(e){const t=e.currentTarget,n=t.dataset.action,s=t.closest("[data-comment-id]").dataset.commentId;switch(n){case"like":this.likeComment(s);break;case"reply":this.replyToComment(s);break;case"edit":this.editComment(s);break;case"delete":this.deleteComment(s)}}likeComment(e){const t=this.findComment(e);t&&(t.likes=(t.likes||0)+1,this.render())}replyToComment(e){const t=document.querySelector("#comment-text");t.value=`@${this.findComment(e).author} `,t.focus(),this.updateCharacterCount({target:t})}findComment(e){let t=this.comments.find(t=>t.id===e);if(t)return t;for(const n of this.comments)if(n.replies&&(t=n.replies.find(t=>t.id===e),t))return t;return null}handleSort(e){const t=e.currentTarget;this.sortBy=t.dataset.sort,document.querySelectorAll(".sort-btn").forEach(e=>{e.classList.remove("active")}),t.classList.add("active"),this.render()}sortComments(e){const t=[...e];switch(this.sortBy){case"newest":return t.sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp));case"oldest":return t.sort((e,t)=>new Date(e.timestamp)-new Date(t.timestamp));case"popular":return t.sort((e,t)=>(t.likes||0)-(e.likes||0));default:return t}}updateCharacterCount(e){const t=e.target.value.length,n=document.querySelector("#char-count"),s=document.querySelector("#submit-btn");n&&(n.textContent=t,n.style.color=t>.9*this.options.maxCharacters?"#ff6b6b":"#666"),s&&(s.disabled=0===t||t>this.options.maxCharacters)}handleRichTextAction(e){const t=e.currentTarget.dataset.action,n=document.querySelector("#comment-text"),s=n.selectionStart,o=n.selectionEnd,a=n.value.substring(s,o);let i="";switch(t){case"bold":i=`**${a||"ç²—ä½“æ–‡æœ¬"}**`;break;case"italic":i=`*${a||"æ–œä½“æ–‡æœ¬"}*`;break;case"code":i=`\`${a||"ä»£ç "}\``;break;case"quote":i=`> ${a||"å¼•ç”¨æ–‡æœ¬"}`;break;case"link":const e=prompt("è¯·è¾“å…¥é“¾æ¥åœ°å€:","https://");e&&(i=`[${a||"é“¾æ¥æ–‡æœ¬"}](${e})`)}i&&(n.value=n.value.substring(0,s)+i+n.value.substring(o),n.focus(),n.setSelectionRange(s+i.length,s+i.length),this.updateCharacterCount({target:n}))}formatContent(e){return e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/^> (.*?)$/gm,"<blockquote>$1</blockquote>").replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank">$1</a>').replace(/\n/g,"<br>")}formatTime(e){const t=new Date(e),n=new Date-t,s=Math.floor(n/6e4),o=Math.floor(n/36e5),a=Math.floor(n/864e5);return s<1?"åˆšåˆš":s<60?`${s}åˆ†é’Ÿå‰`:o<24?`${o}å°æ—¶å‰`:a<30?`${a}å¤©å‰`:t.toLocaleDateString("zh-CN")}getTotalComments(){let e=this.comments.length;return this.comments.forEach(t=>{t.replies&&(e+=t.replies.length)}),e}showSuccess(e){this.showNotification(e,"success")}showError(e){this.showNotification(e,"error")}showNotification(e,t="info"){const n=document.createElement("div");n.className=`notification ${t}`,n.textContent=e,n.style.cssText=`\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            padding: 1rem 1.5rem;\n            background: ${"success"===t?"#d4edda":"error"===t?"#f8d7da":"#d1ecf1"};\n            border: 1px solid ${"success"===t?"#c3e6cb":"error"===t?"#f5c6cb":"#bee5eb"};\n            border-radius: 6px;\n            color: ${"success"===t?"#155724":"error"===t?"#721c24":"#0c5460"};\n            z-index: 1000;\n            animation: slideIn 0.3s ease;\n        `,document.body.appendChild(n),setTimeout(()=>{n.style.animation="slideOut 0.3s ease",setTimeout(()=>n.remove(),300)},3e3)}}document.addEventListener("DOMContentLoaded",()=>{document.querySelector("#comments")&&new EnhancedComments});const style=document.createElement("style");style.textContent="\n    @keyframes slideIn {\n        from {\n            transform: translateX(100%);\n            opacity: 0;\n        }\n        to {\n            transform: translateX(0);\n            opacity: 1;\n        }\n    }\n    \n    @keyframes slideOut {\n        from {\n            transform: translateX(0);\n            opacity: 1;\n        }\n        to {\n            transform: translateX(100%);\n            opacity: 0;\n        }\n    }\n",document.head.appendChild(style),"undefined"!=typeof module&&module.exports&&(module.exports=EnhancedComments);